<!DOCTYPE html>
<html lang="gu">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ркмрк╛рк│ркХ ркорк╛рк╣рк┐ркдрлА рк╡рлНркпрк╡рк╕рлНркерк╛рккрки рккрлНрк░ркгрк╛рк▓рлА</title>

<!-- DataTables CSS (for buttons/colvis) -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css">

<!-- Font Awesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
  /* CSS Variables for Light Theme */
  :root {
    --bg: linear-gradient(135deg, #f8f9ff 0%, #e6f0ff 100%);
    --card: #ffffff;
    --primary: #6a11cb;
    --secondary: #2575fc;
    --accent: #ff6b6b;
    --muted: #6c757d;
    --success: #28a745;
    --warning: #ffc107;
    --danger: #dc3545;
    --info: #17a2b8;
    --light: #f8f9fa;
    --dark: #343a40;
    --radius: 12px;
    --shadow: 0 10px 30px rgba(0,0,0,0.1);
    --shadow-sm: 0 4px 6px rgba(0,0,0,0.07);
    --text-color: #333;
    --header-bg: linear-gradient(90deg, #6a11cb, #2575fc);
    --form-bg: linear-gradient(to right, #ffffff, #f8f9ff);
    --border-color: #eaeef7;
    --table-header-bg: linear-gradient(to right, #f8f9ff, #eaeef7);
    --table-row-hover: #eaeef7;
    --table-row-even: #f8f9ff;
    --footer-bg: linear-gradient(to right, #f8f9ff, #eaeef7);
    --toggle-bg: #6a11cb;
    --toggle-circle: #ffffff;
    --checkbox-border: #ccc;
    --checkbox-checked: var(--primary);
  }

  /* CSS Variables for Dark Theme */
  [data-theme="dark"] {
    --bg: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
    --card: #1e1e2e;
    --primary: #bb86fc;
    --secondary: #03dac6;
    --accent: #cf6679;
    --muted: #9ca3af;
    --success: #4caf50;
    --warning: #ff9800;
    --danger: #f44336;
    --info: #03a9f4;
    --light: #374151;
    --dark: #f9fafb;
    --radius: 12px;
    --shadow: 0 10px 30px rgba(0,0,0,0.3);
    --shadow-sm: 0 4px 6px rgba(0,0,0,0.2);
    --text-color: #e5e7eb;
    --header-bg: linear-gradient(90deg, #bb86fc, #03dac6);
    --form-bg: linear-gradient(to right, #1e1e2e, #2d2d44);
    --border-color: #374151;
    --table-header-bg: linear-gradient(to right, #374151, #4b5563);
    --table-row-hover: #374151;
    --table-row-even: #2d3748;
    --footer-bg: linear-gradient(to right, #1e1e2e, #2d2d44);
    --toggle-bg: #bb86fc;
    --toggle-circle: #f9fafb;
    --checkbox-border: #555;
    --checkbox-checked: var(--primary);
  }

  *{box-sizing:border-box}
  body{
    margin:0;
    background:var(--bg);
    font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    color:var(--text-color);
    line-height:1.6;
    padding:20px;
    transition: all 0.3s ease;
  }
  .container{
    max-width:1200px;
    margin:0 auto;
    background:var(--card);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    padding:30px;
    animation: fadeIn 0.5s ease-in-out;
    transition: all 0.3s ease;
  }
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  /* Theme Toggle Switch */
  .theme-toggle-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1000;
  }
  
  .theme-toggle {
    position: relative;
    width: 70px;
    height: 34px;
    background: var(--toggle-bg);
    border-radius: 34px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  }
  
  .theme-toggle-circle {
    position: absolute;
    top: 3px;
    left: 3px;
    width: 28px;
    height: 28px;
    background: var(--toggle-circle);
    border-radius: 50%;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .theme-toggle-circle i {
    font-size: 16px;
    color: var(--toggle-bg);
  }
  
  [data-theme="dark"] .theme-toggle-circle {
    transform: translateX(36px);
  }
  
  /* Dropdown for Age Group Filter */
  .custom-dropdown {
      position: relative;
      display: inline-block;
      min-width: 200px;
  }
  
  .dropdown-btn {
      padding: 10px 15px;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      background: var(--card);
      color: var(--text-color);
      text-align: left;
      cursor: pointer;
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.3s ease;
  }
  .dropdown-btn:hover {
      border-color: var(--primary);
  }

  .dropdown-content {
      display: none;
      position: absolute;
      background-color: var(--card);
      min-width: 200px;
      box-shadow: var(--shadow);
      border-radius: 8px;
      z-index: 10;
      padding: 10px 0;
      margin-top: 4px;
      border: 1px solid var(--border-color);
  }
  .dropdown-content.show {
      display: block;
  }

  /* Checkbox styling inside dropdown */
  .checkbox-group label {
      display: flex;
      align-items: center;
      padding: 5px 15px;
      cursor: pointer;
      font-weight: normal;
      font-size: 14px;
      color: var(--text-color);
      transition: background-color 0.2s;
  }
  .checkbox-group label:hover {
      background-color: var(--table-row-hover);
  }
  .checkbox-group input[type="checkbox"] {
      margin-right: 8px;
      width: 16px;
      height: 16px;
      min-width: 16px;
      border: 1px solid var(--checkbox-border);
      border-radius: 4px;
      appearance: none;
      -webkit-appearance: none;
      cursor: pointer;
      transition: all 0.2s ease;
      background: var(--card);
  }
  .checkbox-group input[type="checkbox"]:checked {
      background-color: var(--checkbox-checked);
      border-color: var(--checkbox-checked);
  }
  .checkbox-group input[type="checkbox"]:checked::before {
      content: '\2713'; /* Checkmark Unicode */
      display: block;
      color: white;
      font-size: 12px;
      text-align: center;
      line-height: 14px;
  }
  
  h1{
    margin:0 0 20px;
    font-size:28px;
    color:var(--primary);
    text-align:center;
    position:relative;
    padding-bottom:15px;
  }
  h1:after {
    content: "";
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 100px;
    height: 3px;
    background: linear-gradient(90deg, var(--primary), var(--secondary));
    border-radius: 3px;
  }
  /* Header with icon */
  .header-icon {
    display: flex;
    justify-content: center;
    margin-bottom: 20px;
  }
  .header-icon i {
    font-size: 48px;
    color: var(--primary);
    background: rgba(106, 17, 203, 0.1);
    padding: 15px;
    border-radius: 50%;
    transition: all 0.3s ease;
  }
  
  [data-theme="dark"] .header-icon i {
    background: rgba(187, 134, 252, 0.1);
  }
  
  /* Form styling */
  .form-card {
    background: var(--form-bg);
    border-radius: var(--radius);
    padding: 25px;
    margin-bottom: 25px;
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--border-color);
    transition: all 0.3s ease;
  }
  
  .form-title {
    font-size: 20px;
    color: var(--primary);
    margin-bottom: 20px;
    display: flex;
    align-items: center;
  }
  .form-title i {
    margin-right: 10px;
  }
  /* Updated grid layout for new field */
  form{
    display:grid;
    grid-template-columns:1fr 1fr 1fr; /* 3 columns for better use of space */
    gap:15px;
  }
  @media(max-width:900px){form{grid-template-columns:1fr 1fr}} /* 2 columns on tablet */
  @media(max-width:550px){form{grid-template-columns:1fr}} /* 1 column on mobile */

  .form-group {
    display: flex;
    flex-direction: column;
  }
  label{
    font-size:14px;
    color:var(--text-color);
    margin-bottom:6px;
    font-weight:600;
    display: flex;
    align-items: center;
  }
  label i {
    margin-right: 5px;
    color: var(--primary);
  }
  input[type="text"], input[type="date"], input[type="tel"], input[type="number"], select{
    width:100%;
    padding:12px 15px;
    border:1px solid var(--border-color);
    border-radius:8px;
    background:var(--card);
    font-size:14px;
    color:var(--text-color);
    transition:all 0.3s ease;
  }
  
  input:focus, select:focus{
    outline:none;
    border-color:var(--primary);
    box-shadow:0 0 0 3px rgba(106, 17, 203, 0.2);
  }
  
  .btn-primary{
    grid-column:1/-1;
    background:linear-gradient(90deg,var(--primary),var(--secondary));
    color:white;
    padding:12px 20px;
    border-radius:8px;
    border:none;
    font-weight:600;
    cursor:pointer;
    font-size:16px;
    transition:all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .btn-primary:hover{
    transform:translateY(-2px);
    box-shadow:0 5px 15px rgba(106, 17, 203, 0.3);
  }
  
  /* Filters section */
  .filters-card {
    background: var(--form-bg);
    border-radius: var(--radius);
    padding: 20px;
    margin-bottom: 25px;
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--border-color);
    transition: all 0.3s ease;
  }
  
  .filters-title {
    font-size: 18px;
    color: var(--primary);
    margin-bottom: 15px;
    display: flex;
    align-items: center;
  }
  .filters-title i {
    margin-right: 10px;
  }
  .filters{
    display:flex;
    gap:15px;
    align-items:flex-start; 
    flex-wrap:wrap;
    justify-content:space-between;
  }
  
  .filter-options {
    display: flex;
    gap: 15px;
    align-items: flex-start;
  }

  .filters select{
    padding:10px 15px;
    border-radius:8px;
    border:1px solid var(--border-color);
    background:var(--card);
    min-width:150px;
    color:var(--text-color);
  }
  
  /* Custom Import/Export Buttons */
  .custom-action-buttons .btn {
      background: linear-gradient(90deg, #17a2b8, #0c7b93);
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-right: 8px;
      display: inline-flex;
      align-items: center;
  }
  .custom-action-buttons .btn:last-child {
      background: linear-gradient(90deg, #ffc107, #e0a800);
      color: #333;
  }
  .custom-action-buttons .btn i {
      margin-right: 5px;
  }
  .custom-action-buttons .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(23, 162, 184, 0.3);
  }
  .custom-action-buttons .btn:last-child:hover {
      box-shadow: 0 4px 8px rgba(255, 193, 7, 0.3);
  }
  /* Hiding the file input */
  #importFile {
      display: none;
  }
  
  /* Records per page selector */
  .records-selector {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 12px;
  }
  
  .records-selector label {
    margin: 0;
    font-size: 12px;
    color: var(--text-color);
    white-space: nowrap;
  }
  
  .records-selector select {
    padding: 4px 8px;
    border-radius: 4px;
    border: 1px solid var(--border-color);
    background: var(--card);
    color: var(--text-color);
    min-width: auto;
    font-size: 12px;
    width: 50px;
  }
  
  /* Table section */
  .table-card {
    background: var(--form-bg);
    border-radius: var(--radius);
    padding: 20px;
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--border-color);
    transition: all 0.3s ease;
  }
  
  .table-wrap{
    overflow:auto;
    background:var(--card);
    padding:15px;
    border-radius:8px;
    box-shadow:var(--shadow-sm);
  }
  table.dataTable{
    width:100% !important;
    border-collapse:collapse;
  }
  th,td{
    padding:12px 15px;
    border-bottom:1px solid var(--border-color);
    vertical-align:middle;
  }
  th{
    background:var(--table-header-bg);
    font-weight:600;
    color:var(--primary);
    position: sticky;
    top: 0;
  }
  tr:nth-child(even) td{
    background:var(--table-row-even);
  }
  tr:hover td {
    background: var(--table-row-hover);
  }
  /* Grade pills */
  .pill{
    display:inline-block;
    padding:6px 12px;
    border-radius:20px;
    color:white;
    font-weight:600;
    font-size:13px;
  }
  .pill.ok{background:var(--success)}
  .pill.warn{background:var(--warning);color:#333}
  .pill.bad{background:var(--danger)}
  /* Action buttons */
  .action-btn{
    border:none;
    padding:8px 12px;
    border-radius:6px;
    color:#fff;
    font-weight:600;
    cursor:pointer;
    margin-right:5px;
    transition:all 0.3s ease;
  }
  .action-btn i {
    margin-right: 5px;
  }
  .edit{
    background:linear-gradient(90deg,var(--info),#0c7b93);
  }
  .del{
    background:linear-gradient(90deg,var(--danger),#a71e2a);
  }
  .dt-button{
    border-radius:8px;
    padding:8px 12px;
    margin-right:8px;
    background:linear-gradient(90deg,var(--primary),var(--secondary));
    border:none;
    color:#fff;
    font-weight:600;
    transition:all 0.3s ease;
  }
  
  /* Responsive adjustments (Mobile-Friendly) */
  @media(max-width:768px){
    .container{padding:15px;}
    h1{font-size:24px;}
    .filters-card, .table-card { padding: 15px; }
    
    .filters {
        flex-direction: column;
        align-items: stretch;
    }
    .filter-options {
        flex-direction: column;
        gap: 10px;
        align-items: stretch;
    }
    /* Set minimum width for dropdown and select on mobile */
    .custom-dropdown, .filters select {
        min-width: 100%; 
        width: 100%;
    }
    .filters select {
        box-sizing: border-box; 
    }
    /* Fix dropdown content overflow on small screens */
    .dropdown-content {
        min-width: 90vw; /* Take up most of viewport width */
        right: 0; /* Align right on mobile */
        left: auto;
    }
    .dt-buttons {
        display: flex;
        flex-wrap: wrap;
        width: 100%;
        gap: 5px;
        margin-bottom: 10px;
    }
    .dt-button {
        width: calc(50% - 5px);
        margin-right: 0;
        margin-bottom: 5px;
        font-size: 11px;
        padding: 5px 6px;
    }
    .custom-action-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 10px;
    }
    .custom-action-buttons .btn {
        flex-grow: 1; /* Allow buttons to expand */
        margin-right: 0;
        font-size: 12px;
    }
  }
  
  /* Success message */
  .success-message {
    background: var(--success);
    color: white;
    padding: 10px 15px;
    border-radius: 8px;
    margin-bottom: 15px;
    display: none;
    align-items: center;
  }
  .error-message {
    background: var(--danger);
    color: white;
    padding: 10px 15px;
    border-radius: 8px;
    margin-bottom: 15px;
    display: none;
    align-items: center;
  }
  .success-message i, .error-message i {
    margin-right: 10px;
  }
</style>
</head>
<body>

<div class="theme-toggle-container">
  <div class="theme-toggle" id="themeToggle">
    <div class="theme-toggle-circle">
      <i class="fas fa-sun" id="themeIcon"></i>
    </div>
  </div>
</div>

<div class="container">
  <div class="header-icon">
    <i class="fas fa-child"></i>
  </div>
  <h1>ркмрк╛рк│ркХ ркорк╛рк╣рк┐ркдрлА рк╡рлНркпрк╡рк╕рлНркерк╛рккрки рккрлНрк░ркгрк╛рк▓рлА</h1>

  <!-- Success Message -->
  <div class="success-message" id="successMessage">
    <i class="fas fa-check-circle"></i>
    <span id="successText">ркорк╛рк╣рк┐ркдрлА рк╕рклрк│ркдрк╛рккрлВрк░рлНрк╡ркХ рк╕рк╛ркЪрк╡рлА ркЧркИ!</span>
  </div>
  <!-- Error Message -->
  <div class="error-message" id="errorMessage">
    <i class="fas fa-times-circle"></i>
    <span id="errorText">ркорк╛рк╣рк┐ркдрлА Import ркХрк░рк╡рк╛ркорк╛ркВ ркнрлВрк▓!</span>
  </div>

  <!-- Form Card -->
  <div class="form-card">
    <div class="form-title">
      <i class="fas fa-user-plus"></i>
      ркмрк╛рк│ркХркирлА ркорк╛рк╣рк┐ркдрлА ркЙркорлЗрк░рлЛ
    </div>
    <form id="childForm">
      <input type="hidden" id="editId">
      
      <!-- Row 1 -->
      <div class="form-group">
        <label for="name"><i class="fas fa-user"></i> ркмрк╛рк│ркХркирлБркВ ркирк╛рко</label>
        <input id="name" type="text" required placeholder="ркмрк╛рк│ркХркирлБркВ рккрлВрк░рлБркВ ркирк╛рко рк▓ркЦрлЛ">
      </div>
      <div class="form-group">
        <label for="motherName"><i class="fas fa-female"></i> ркорк╛ркдрк╛ркирлБркВ ркирк╛рко</label>
        <input id="motherName" type="text" required placeholder="ркорк╛ркдрк╛ркирлБркВ рккрлВрк░рлБркВ ркирк╛рко">
      </div>
      <div class="form-group">
        <label for="dob"><i class="fas fa-calendar-alt"></i> ркЬркирлНркоркдрк╛рк░рлАркЦ</label>
        <input id="dob" type="date" required>
      </div>

      <!-- Row 2 -->
      <div class="form-group">
        <label for="sex"><i class="fas fa-venus-mars"></i> рк▓рк┐ркВркЧ</label>
        <select id="sex" required>
          <option value="">рккрк╕ркВркж ркХрк░рлЛ</option>
          <option value="boy">ркЫрлЛркХрк░рлЛ</option>
          <option value="girl">ркЫрлЛркХрк░рлА</option>
        </select>
      </div>
      <div class="form-group">
        <label for="mobileNumber"><i class="fas fa-mobile-alt"></i> ркорлЛркмрк╛ркЗрк▓ ркиркВркмрк░</label>
        <input id="mobileNumber" type="tel" placeholder="10 ркЕркВркХркирлЛ ркорлЛркмрк╛ркЗрк▓ ркиркВркмрк░">
      </div>
      <div class="form-group">
        <label for="aadhaarNumber"><i class="fas fa-id-card"></i> ркЖркзрк╛рк░ ркиркВркмрк░</label>
        <input id="aadhaarNumber" type="text" placeholder="12 ркЕркВркХркирлЛ ркЖркзрк╛рк░ ркиркВркмрк░">
      </div>

      <!-- Row 3 -->
      <div class="form-group">
        <label for="apaarId"><i class="fas fa-address-card"></i> ркЕрккрк╛рк░ ID</label>
        <input id="apaarId" type="text" placeholder="ркЬрлЛ рк╣рлЛркп ркдрлЛ">
      </div>
      <div class="form-group">
        <label for="abhaId"><i class="fas fa-hospital"></i> ркЖркнрк╛ ID</label>
        <input id="abhaId" type="text" placeholder="ркЬрлЛ рк╣рлЛркп ркдрлЛ">
      </div>
      <div class="form-group">
        <label for="weightDate"><i class="fas fa-calendar-check"></i> рк╡ркЬрки ркХрк░рлНркпрк╛ ркдрк╛рк░рлАркЦ</label>
        <input id="weightDate" type="date" required>
      </div>

      <!-- Row 4 -->
      <div class="form-group">
        <label for="weight"><i class="fas fa-weight"></i> рк╡ркЬрки (ркХрк┐ркЧрлНрк░рк╛)</label>
        <input id="weight" type="number" step="0.1" required placeholder="ркЙркжрк╛рк╣рк░ркг: 6.5">
      </div>
      <div class="form-group">
        <label for="height"><i class="fas fa-ruler-vertical"></i> ркКркВркЪрк╛ркИ (рк╕рлЗркорлА)</label>
        <input id="height" type="number" step="0.1" required placeholder="ркЙркжрк╛рк╣рк░ркг: 65.2">
      </div>
      <!-- Empty group for layout alignment or new fields -->
      <div class="form-group"></div> 

      <button class="btn-primary" type="submit">
        <i class="fas fa-save"></i>
        ркмрк╛рк│ркХ ркЙркорлЗрк░рлЛ / ркЕрккркбрлЗркЯ ркХрк░рлЛ
      </button>
    </form>
  </div>

  <!-- Filters Card -->
  <div class="filters-card">
    <div class="filters-title">
      <i class="fas fa-filter"></i>
      рклрк┐рк▓рлНркЯрк░рлНрк╕ ркЕркирлЗ ркПркХрлНрк╕рккрлЛрк░рлНркЯ
    </div>
    <div class="filters">
      <!-- DT Buttons and Custom Export/Import -->
      <div style="display:flex; flex-direction:column; gap:8px;">
        <div id="dtButtons"></div>
        <div class="custom-action-buttons">
            <!-- Export Button -->
            <button class="btn" id="exportBtn"><i class="fas fa-file-export"></i> ркбрлЗркЯрк╛ Export (JSON)</button>
            <!-- Import Button (hidden file input) -->
            <input type="file" id="importFile" accept="application/json">
            <button class="btn" id="importBtn"><i class="fas fa-file-import"></i> ркбрлЗркЯрк╛ Import (JSON)</button>
        </div>
      </div>

      <!-- Filters -->
      <div class="filter-options">
        
        <!-- Age Group Custom Dropdown -->
        <div class="custom-dropdown">
            <button type="button" class="dropdown-btn" id="ageGroupDropdownBtn">
                <span id="ageGroupLabel">ркЙркВркорк░ ркЬрлВркеркерлА рклрк┐рк▓рлНркЯрк░ ркХрк░рлЛ</span>
                <i class="fas fa-caret-down"></i>
            </button>
            <div class="dropdown-content" id="ageGroupDropdownContent">
                <div class="checkbox-group">
                    <label><input type="checkbox" class="age-filter-checkbox" value="(0-6mnth)"> 0-6 ркорк╣рк┐ркирк╛</label>
                    <label><input type="checkbox" class="age-filter-checkbox" value="(6-1yr)"> 6-12 ркорк╣рк┐ркирк╛</label>
                    <label><input type="checkbox" class="age-filter-checkbox" value="(1-3 yr)"> 1-3 рк╡рк░рлНрк╖</label>
                    <label><input type="checkbox" class="age-filter-checkbox" value="(3-5 yr)"> 3-5 рк╡рк░рлНрк╖</label>
                    <label><input type="checkbox" class="age-filter-checkbox" value="(5-6 yr)"> 5-6 рк╡рк░рлНрк╖</label>
                </div>
            </div>
        </div>

        <select id="sexFilter" title="рк▓рк┐ркВркЧркерлА рклрк┐рк▓рлНркЯрк░">
          <option value="">ркмркзрк╛ (рк▓рк┐ркВркЧ)</option>
          <option value="boy">ркЫрлЛркХрк░рлЛ</option>
          <option value="girl">ркЫрлЛркХрк░рлА</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Table Card -->
  <div class="table-card">
    <!-- ... table header content ... -->
    <div class="table-header">
      <div class="table-title">
        <i class="fas fa-table"></i>
        ркмрк╛рк│ркХрлЛркирлА ркорк╛рк╣рк┐ркдрлА
      </div>
      <div class="records-selector">
        <label for="recordsPerPage">рккрлНрк░ркдрк┐ рккрлЗркЬ:</label>
        <select id="recordsPerPage">
          <option value="10">10</option>
          <option value="15">15</option>
          <option value="20">20</option>
        </select>
      </div>
    </div>
    <div class="loader" id="tableLoader"></div>
    <div class="table-wrap">
      <div class="table-wrap-inner" style="margin-top:10px">
        <table id="childTable" class="display" style="width:100%">
          <thead>
            <tr>
              <th>ркХрлНрк░рко</th>
              <th>ркмрк╛рк│ркХркирлБркВ ркирк╛рко</th>
              <th>ркорк╛ркдрк╛ркирлБркВ ркирк╛рко</th>
              <th>рк▓рк┐ркВркЧ</th>
              <th>ркЬркирлНркоркдрк╛рк░рлАркЦ</th>
              <th>ркЙркВркорк░</th>
              <th>ркЙркВркорк░ркЬрлВрке</th>
              <th>ркорлЛркмрк╛ркЗрк▓</th>
              <th>ркЖркзрк╛рк░</th>
              <th>ркЕрккрк╛рк░ ID</th>
              <th>ркЖркнрк╛ ID</th>
              <th>рк╡ркЬрки ркХрк░рлНркпрк╛ ркдрк╛рк░рлАркЦ</th> <!-- NEW COLUMN -->
              <th>рк╡ркЬрки</th>
              <th>ркКркВркЪрк╛ркИ</th>
              <th>ркЧрлНрк░рлЗркб</th>
              <th>ркХрлНрк░рк┐ркпрк╛</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <footer>
    <i class="fas fa-code"></i> рк╡рк┐ркХрк╕рк┐ркд ркХрк░рлНркпрлБркВ: ркжрлЗрк╡рлЗркирлНркжрлНрк░ рк░рк╛ркорк╛ркирлБркЬ тАв 9276505035 ЁЯЩП
  </footer>
</div>

<!-- Scripts: jQuery + DataTables + Buttons + export libs -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.colVis.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.print.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>

<script>
/* -------------------------
   Theme Toggle
   ------------------------- */
document.addEventListener('DOMContentLoaded', function() {
  const currentTheme = localStorage.getItem('theme') || 'light';
  document.documentElement.setAttribute('data-theme', currentTheme);
  
  const themeIcon = document.getElementById('themeIcon');
  if (currentTheme === 'dark') {
    themeIcon.classList.remove('fa-sun');
    themeIcon.classList.add('fa-moon');
  }
  
  const themeToggle = document.getElementById('themeToggle');
  themeToggle.addEventListener('click', function() {
    const currentTheme = document.documentElement.getAttribute('data-theme');
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    
    document.documentElement.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
    
    if (newTheme === 'dark') {
      themeIcon.classList.remove('fa-sun');
      themeIcon.classList.add('fa-moon');
    } else {
      themeIcon.classList.remove('fa-moon');
      themeIcon.classList.add('fa-sun');
    }
  });
});

/* -------------------------
   LocalStorage helpers
   ------------------------- */
function getChildren(){ return JSON.parse(localStorage.getItem('childrenData')||'[]'); }
function setChildren(arr){ localStorage.setItem('childrenData', JSON.stringify(arr)); }

/* -------------------------
   Utils: age, group, grade, date format
   ------------------------- */

// Function to format date from YYYY-MM-DD to DD/MM/YYYY
function formatDate(dateStr) {
    if (!dateStr) return '';
    try {
        const [year, month, day] = dateStr.split('-');
        return `${day}/${month}/${year}`;
    } catch (e) {
        return dateStr; // return original if parsing fails
    }
}

function calculateAge(dobStr){
  if(!dobStr) return '';
  const dob = new Date(dobStr);
  const today = new Date();
  let years = today.getFullYear() - dob.getFullYear();
  let months = today.getMonth() - dob.getMonth();
  if (today.getDate() < dob.getDate()) months--;
  if (months < 0) { years--; months += 12; }
  return `${years} рк╡рк░рлНрк╖, ${months} ркорк╣рк┐ркирк╛`;
}
function calculateAgeGroup(dobStr){
  if(!dobStr) return '';
  const dob = new Date(dobStr), today = new Date();
  let totalMonths = (today.getFullYear()-dob.getFullYear())*12 + (today.getMonth()-dob.getMonth());
  if (today.getDate() < dob.getDate()) totalMonths--;
  if (totalMonths <= 6) return "(0-6mnth)";
  if (totalMonths <= 12) return "(6-1yr)";
  if (totalMonths <= 36) return "(1-3 yr)";
  if (totalMonths <= 60) return "(3-5 yr)";
  if (totalMonths <= 72) return "(5-6 yr)";
  return "";
}
function calculateGrade(weight, height){
  const h = Number(height);
  const w = Number(weight);
  if (!h || !w) return { text: '-', cls: '' };
  if (h === 0) return { text: 'ркнрлВрк▓', cls: 'pill bad' };
  const bmi = w / ((h/100)*(h/100));
  if (bmi < 16) return { text: 'ркЕркдрк┐ ркЧркВркнрлАрк░', cls: 'pill bad' };
  if (bmi < 18.5) return { text: 'ркЧркВркнрлАрк░', cls: 'pill warn' };
  return { text: 'рк╕рк╛ркорк╛ркирлНркп', cls: 'pill ok' };
}

/* -------------------------
   Show messages
   ------------------------- */
function showSuccessMessage(message) {
  $('#successText').text(message);
  $('#successMessage').fadeIn().delay(2000).fadeOut();
}
function showErrorMessage(message) {
  $('#errorText').text(message);
  $('#errorMessage').fadeIn().delay(3000).fadeOut();
}

/* -------------------------
   DataTable initialization
   ------------------------- */
let table;
function initDataTable(){
  if ($.fn.DataTable.isDataTable('#childTable')) {
    table.clear().draw();
    table.destroy();
  }

  const isMobile = window.innerWidth < 768;
  const recordsPerPage = $('#recordsPerPage').val() || 10;

  table = $('#childTable').DataTable({
    dom: isMobile ? 'Brtip' : 'lBrtip',
    buttons: [
      { extend: 'excelHtml5', text: '<i class="fas fa-file-excel"></i> ркПркХрлНрк╕рлЗрк▓' },
      { extend: 'pdfHtml5', text: '<i class="fas fa-file-pdf"></i> рккрлАркбрлАркПркл' },
      { extend: 'print', text: '<i class="fas fa-print"></i> ркЫрк╛рккрлЛ' },
      { extend: 'colvis', text: '<i class="fas fa-columns"></i> ркХрлЙрк▓рко' }
    ],
    // Updated targets for the new column index (16 total columns now)
    columnDefs: [
      { targets: 15, orderable: false }
    ],
    paging: true,
    pageLength: parseInt(recordsPerPage),
    lengthChange: !isMobile,
    lengthMenu: [[10, 15, 20], [10, 15, 20]],
    info: true,
    language: { 
      emptyTable: "ркХрлЛркИ рк░рлЗркХрлЛрк░рлНркб ркорк│рлНркпрк╛ ркиркерлА",
      info: "ркХрлБрк▓ _START_ ркерлА _END_ ркирк╛ _TOTAL_ рк░рлЗркХрлЛрк░рлНркб",
      paginate: {
        first: "рккрлНрк░ркерко",
        last: "ркЕркВркдрк┐рко",
        next: "ркЖркЧрк│",
        previous: "рккрк╛ркЫрк│"
      },
      lengthMenu: "рккрлНрк░ркдрк┐ рккрлЗркЬ _MENU_ рк░рлЗркХрлЛрк░рлНркб ркмркдрк╛рк╡рлЛ"
    },
    responsive: true
  });

  table.buttons().container().appendTo('#dtButtons');
}

/* -------------------------
   Render rows from storage
   ------------------------- */
function renderRows(){
  $('#tableLoader').show();
  initDataTable();
  const data = getChildren();
  data.forEach((c, idx) => {
    const grade = calculateGrade(c.weight, c.height);
    const ageGroupText = calculateAgeGroup(c.dob); 
    const row = [
      idx + 1,
      c.name || '',
      c.motherName || '',
      c.sex === 'boy' ? 'ркЫрлЛркХрк░рлЛ' : (c.sex === 'girl' ? 'ркЫрлЛркХрк░рлА' : ''),
      c.dob || '',
      calculateAge(c.dob),
      ageGroupText, // Column index 6
      c.mobileNumber || '',
      c.aadhaarNumber || '',
      c.apaarId || '',
      c.abhaId || '',
      formatDate(c.weightDate), // NEW: Column index 11 (Formatted Date)
      c.weight !== undefined ? c.weight : '', // Column index 12
      c.height !== undefined ? c.height : '', // Column index 13
      `<span class="${grade.cls}">${grade.text}</span>`, // Column index 14
      `<button class="action-btn edit" data-id="${c.id}"><i class="fas fa-edit"></i> рк╕рлБркзрк╛рк░рлЛ</button>
       <button class="action-btn del" data-id="${c.id}"><i class="fas fa-trash"></i> ркХрк╛ркврлЛ</button>` // Column index 15
    ];
    table.row.add(row).draw(false);
  });
  $('#tableLoader').hide();

  // Wire edit/delete clicks (delegated)
  $('#childTable tbody').off('click').on('click', 'button.edit', function(){
    const id = Number($(this).data('id')); startEdit(id);
  });
  $('#childTable tbody').on('click', 'button.del', function(){
    const id = Number($(this).data('id')); confirmDelete(id);
  });
}

/* -------------------------
   Form handlers: add / edit
   ------------------------- */
 $('#childForm').on('submit', function(e){
  e.preventDefault();
  const editId = $('#editId').val();
  const child = {
    id: editId ? Number(editId) : Date.now(),
    name: $('#name').val().trim(),
    motherName: $('#motherName').val().trim(),
    sex: $('#sex').val(),
    dob: $('#dob').val(),
    mobileNumber: $('#mobileNumber').val().trim(),
    aadhaarNumber: $('#aadhaarNumber').val().trim(),
    apaarId: $('#apaarId').val().trim(),
    abhaId: $('#abhaId').val().trim(),
    weightDate: $('#weightDate').val(), // NEW: Capture Weight Date
    weight: $('#weight').val(),
    height: $('#height').val()
  };

  let arr = getChildren();
  if (editId) {
    arr = arr.map(x => x.id === child.id ? child : x);
    showSuccessMessage('ркмрк╛рк│ркХркирлА ркорк╛рк╣рк┐ркдрлА рк╕рклрк│ркдрк╛рккрлВрк░рлНрк╡ркХ ркЕрккркбрлЗркЯ ркХрк░рк╛ркИ!');
  } else {
    arr.push(child);
    showSuccessMessage('ркирк╡рк╛ ркмрк╛рк│ркХркирлА ркорк╛рк╣рк┐ркдрлА рк╕рклрк│ркдрк╛рккрлВрк░рлНрк╡ркХ ркЙркорлЗрк░рк╛ркИ!');
  }
  setChildren(arr);
  this.reset(); $('#editId').val('');
  renderTableRefresh();
});

/* -------------------------
   Edit & Delete
   ------------------------- */
function startEdit(id){
  const arr = getChildren();
  const c = arr.find(x => x.id === id);
  if (!c) return;
  $('#editId').val(c.id);
  $('#name').val(c.name);
  $('#motherName').val(c.motherName);
  $('#sex').val(c.sex);
  $('#dob').val(c.dob);
  $('#mobileNumber').val(c.mobileNumber);
  $('#aadhaarNumber').val(c.aadhaarNumber);
  $('#apaarId').val(c.apaarId);
  $('#abhaId').val(c.abhaId);
  $('#weightDate').val(c.weightDate); // NEW: Load Weight Date
  $('#weight').val(c.weight);
  $('#height').val(c.height);
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function confirmDelete(id){
  const ok = confirm("рк╢рлБркВ ркдркорлЗ ркЖ рк░рлЗркХрлЛрк░рлНркб ркЦрк░рлЗркЦрк░ ркбрк┐рк▓рлАркЯ ркХрк░рк╡рк╛ ркорк╛ркВркЧрлЛ ркЫрлЛ?");
  if (!ok) return;
  const arr = getChildren().filter(x => x.id !== id);
  setChildren(arr);
  showSuccessMessage('ркмрк╛рк│ркХркирлЛ рк░рлЗркХрлЛрк░рлНркб рк╕рклрк│ркдрк╛рккрлВрк░рлНрк╡ркХ ркХрк╛ркврлА ркирк╛ркЦрк╛ркпрлЛ!');
  renderTableRefresh();
}

/* -------------------------
   Custom Dropdown Logic
   ------------------------- */
$('#ageGroupDropdownBtn').on('click', function(e) {
    $('#ageGroupDropdownContent').toggleClass('show');
    e.stopPropagation();
});

// Close the dropdown if the user clicks outside of it
$(document).on('click', function(e) {
    if (!$(e.target).closest('.custom-dropdown').length) {
        $('#ageGroupDropdownContent').removeClass('show');
    }
});

// Update dropdown label text
function updateAgeGroupLabel() {
    const checkedCount = $('.age-filter-checkbox:checked').length;
    let labelText = 'ркЙркВркорк░ ркЬрлВркеркерлА рклрк┐рк▓рлНркЯрк░ ркХрк░рлЛ';
    if (checkedCount > 0) {
        labelText = `${checkedCount} ркЬрлВрке рккрк╕ркВркж ркХрк░рлЗрк▓ ркЫрлЗ`;
    }
    $('#ageGroupLabel').text(labelText);
}

// Age Group Checkbox change event
$('.age-filter-checkbox').on('change', function() {
    updateAgeGroupLabel();
    handleFilterChange();
});
$('#sexFilter').on('change', handleFilterChange);


/* -------------------------
   Filters: age (checkbox) & sex
   ------------------------- */
function applyFiltersToTable(){
  const selectedAgeGroups = $('.age-filter-checkbox:checked').map(function(){
      return this.value;
  }).get(); 

  const sexVal = $('#sexFilter').val();
  
  // Custom filter function for DataTables
  $.fn.dataTable.ext.search.push(
      function(settings, data, dataIndex) {
          const ageGroup = data[6]; 
          const sex = data[3];       

          let ageMatch = true;
          let sexMatch = true;

          // 1. Age Group Filter
          if (selectedAgeGroups.length > 0) {
              ageMatch = selectedAgeGroups.includes(ageGroup);
          } else {
              ageMatch = true; // Show all if none checked
          }

          // 2. Sex Filter
          if (sexVal && sexVal !== "") {
              sexMatch = (sexVal === 'boy' ? sex === 'ркЫрлЛркХрк░рлЛ' : sex === 'ркЫрлЛркХрк░рлА');
          }
          
          return ageMatch && sexMatch;
      }
  );

  table.draw();
  table.page('first').draw('page');
  
  $.fn.dataTable.ext.search.pop();
}

function handleFilterChange() {
    $.fn.dataTable.ext.search.pop(); 
    applyFiltersToTable();
}

/* -------------------------
   Import/Export Logic
   ------------------------- */

// Export Data to JSON
$('#exportBtn').on('click', function() {
    const data = getChildren();
    const jsonString = JSON.stringify(data, null, 2);
    const blob = new Blob([jsonString], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    
    const a = document.createElement('a');
    a.href = url;
    a.download = 'child_data_export_' + new Date().toISOString().slice(0, 10) + '.json';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    showSuccessMessage('ркбрлЗркЯрк╛ JSON рклрлЛрк░рлНркорлЗркЯркорк╛ркВ рк╕рклрк│ркдрк╛рккрлВрк░рлНрк╡ркХ Export ркеркпрлЛ!');
});

// Trigger file selection on Import button click
$('#importBtn').on('click', function() {
    $('#importFile').click();
});

// Import Data from JSON
$('#importFile').on('change', function(e) {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(event) {
        try {
            const importedData = JSON.parse(event.target.result);
            if (Array.isArray(importedData)) {
                
                // Basic validation for core fields
                const isValid = importedData.every(item => 
                    item.id !== undefined && item.name !== undefined && item.dob !== undefined
                );

                if (isValid || importedData.length === 0) {
                    setChildren(importedData);
                    renderTableRefresh();
                    showSuccessMessage(`ркХрлБрк▓ ${importedData.length} рк░рлЗркХрлЛрк░рлНркб рк╕рклрк│ркдрк╛рккрлВрк░рлНрк╡ркХ Import ркеркпрк╛!`);
                } else {
                    showErrorMessage('Import ркХрк░рлЗрк▓ рклрк╛ркЗрк▓ркорк╛ркВ ркбрлЗркЯрк╛ рклрлЛрк░рлНркорлЗркЯ ркЕркпрлЛркЧрлНркп ркЫрлЗ.');
                }
                
            } else {
                showErrorMessage('ркЕркпрлЛркЧрлНркп JSON рклрлЛрк░рлНркорлЗркЯ: ркбрлЗркЯрк╛ ркПрк░рлЗ (array) рк╣рлЛрк╡рлЛ ркЬрлЛркИркП.');
            }
        } catch (error) {
            console.error("Import Error:", error);
            showErrorMessage('JSON рклрк╛ркЗрк▓ рк╡рк╛ркВркЪрк╡рк╛ркорк╛ркВ ркЕркерк╡рк╛ рккрк╛рк░рк╕ (parse) ркХрк░рк╡рк╛ркорк╛ркВ ркнрлВрк▓ ркеркИ.');
        } finally {
             e.target.value = '';
        }
    };
    reader.readAsText(file);
});


/* -------------------------
   Helper to refresh table
   ------------------------- */
function renderTableRefresh(){
  $.fn.dataTable.ext.search.pop(); 
  
  const currentPageLength = $('#recordsPerPage').val(); 
  
  if ($.fn.DataTable.isDataTable('#childTable')) {
    table.clear().draw();
    table.destroy();
  }
  
  $('#recordsPerPage').val(currentPageLength); 
  
  renderRows();
  updateAgeGroupLabel(); 
  applyFiltersToTable();
}

/* -------------------------
   Records per page selector
   ------------------------- */
$('#recordsPerPage').on('change', function() {
  const recordsPerPage = $(this).val();
  if ($.fn.DataTable.isDataTable('#childTable')) {
     table.page.len(recordsPerPage).draw();
  } else {
     renderTableRefresh();
  }
});

/* -------------------------
   Initial load
   ------------------------- */
 $(document).ready(function(){
  renderTableRefresh();
});
</script>
</body>
</html>
